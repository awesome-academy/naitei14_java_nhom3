<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Quản Lý Người Dùng</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" th:href="@{/admin.css}">
</head>
<body class="bg-gray-50 font-sans">

	<div th:replace="~{fragments/sidebar :: sidebar}"></div>
	<div class="ml-64">
		<div th:replace="~{fragments/header :: header}"></div>

		<main class="p-8">
			<div class="bg-white rounded-xl shadow-md overflow-hidden">
				<div
					class="p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-white">
					<div class="flex justify-between items-center mb-4">
						<h3 class="text-2xl font-bold text-gray-900">Danh Sách Người
							Dùng</h3>
					</div>

					<form th:action="@{/admin/users}" method="get"
						class="flex flex-wrap gap-3">

						<select name="status"
							class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
							<option value=""
								th:selected="${currentStatus == null || currentStatus == ''}">--
								Trạng thái --</option>

							<option value="ACTIVE" th:selected="${currentStatus == 'ACTIVE'}">Active</option>

							<option value="BLOCKED"
								th:selected="${currentStatus == 'BLOCKED'}">Blocked</option>

							<option value="UNVERIFIED"
								th:selected="${currentStatus == 'UNVERIFIED'}">Unverified</option>
						</select> <select name="role"
							class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
							<option value=""
								th:selected="${currentRole == null || currentRole == ''}">--
								Role --</option>
							<option value="ADMIN" th:selected="${currentRole == 'ADMIN'}">Admin</option>
							<option value="USER" th:selected="${currentRole == 'USER'}">User</option>
							<option value="GUIDE" th:selected="${currentRole == 'GUIDE'}">Guide</option>
						</select>

						<div class="relative flex-1 min-w-[250px]">
							<input type="text" name="keyword" th:value="${currentKeyword}"
								placeholder="Tìm kiếm theo email, tên..."
								class="w-full border border-gray-300 rounded-lg pl-10 pr-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
							<i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
						</div>

						<button type="submit"
							class="bg-blue-600 text-white px-6 py-2 rounded-lg text-sm hover:bg-blue-700 transition shadow-sm font-medium">
							Lọc</button>
					</form>
				</div>

				<div class="overflow-x-auto">
					<table class="w-full text-left border-collapse">
						<thead
							class="bg-gray-50 text-gray-600 text-xs uppercase font-bold border-b">
							<tr>
								<th class="px-6 py-4">ID</th>
								<th class="px-6 py-4">User</th>
								<th class="px-6 py-4">Email</th>
								<th class="px-6 py-4">Role</th>
								<th class="px-6 py-4 text-center">Status</th>
								<th class="px-6 py-4 text-center">Action</th>
							</tr>
						</thead>
						<tbody class="divide-y divide-gray-100 text-sm">
							<tr th:each="user : ${users}" class="hover:bg-blue-50 transition">
								<td class="px-6 py-4 font-medium text-gray-500"
									th:text="'#' + ${user.id}"></td>
								<td class="px-6 py-4">
									<div class="flex items-center space-x-3">
										<img
											th:src="${user.profile != null && user.profile.avatarUrl != null ? user.profile.avatarUrl : 'https://ui-avatars.com/api/?name=' + user.email}"
											class="w-9 h-9 rounded-full border object-cover"> <span
											class="font-bold text-gray-900"
											th:text="${user.profile != null ? user.profile.fullName : 'No Name'}"></span>
									</div>
								</td>
								<td class="px-6 py-4 text-gray-600" th:text="${user.email}"></td>
								<td class="px-6 py-4"><span
									class="px-2.5 py-1 rounded-full text-xs font-bold bg-purple-100 text-purple-700"
									th:text="${!user.roles.isEmpty() ? user.roles[0].name : '---'}"></span>
								</td>
								<td class="px-6 py-4 text-center">
									<form th:action="@{/admin/users/update-status}" method="post">

										<input type="hidden" name="id" th:value="${user.id}">
										<input type="hidden" name="currentStatus"
											th:value="${user.status}"> <input type="hidden"
											name="page" th:value="${currentPage}"> <input
											type="hidden" name="size" th:value="${pageSize}"> <input
											type="hidden" name="filterStatus" th:value="${currentStatus}">
										<input type="hidden" name="filterRole"
											th:value="${currentRole}"> <input type="hidden"
											name="filterKeyword" th:value="${currentKeyword}"> <label
											class="toggle-switch"> <input type="checkbox"
											class="status-checkbox"
											th:checked="${user.status.name() == 'ACTIVE'}"> <span
											class="slider"></span>
										</label>
									</form>

									<div class="text-[10px] font-bold mt-1"
										th:classappend="${user.status.name() == 'ACTIVE'} ? 'text-green-600' : 
                          (${user.status.name() == 'UNVERIFIED'} ? 'text-yellow-600' : 'text-red-600')"
										th:text="${user.status}"></div>
								</td>
								<td class="px-6 py-4 text-center"><a
									th:href="@{/admin/users/{id}(id=${user.id})}"
									class="inline-block bg-white border border-gray-200 text-blue-600 hover:bg-blue-50 hover:text-blue-800 px-3 py-1.5 rounded-lg transition shadow-sm">
										<i class="fas fa-eye mr-1"></i> Chi tiết
								</a></td>
							</tr>
						</tbody>
					</table>
				</div>

				<div
					class="px-6 py-4 bg-gray-50 border-t flex justify-between items-center text-sm text-gray-600">
					<div>
						Hiển thị <span class="font-bold"
							th:text="${totalItems > 0 ? (currentPage - 1) * pageSize + 1 : 0}"></span>
						- <span class="font-bold"
							th:text="${(currentPage * pageSize) > totalItems ? totalItems : (currentPage * pageSize)}"></span>
						trong tổng số <span class="font-bold" th:text="${totalItems}"></span>
						kết quả
					</div>

					<div class="flex gap-1" th:if="${totalPages > 1}">
						<a
							th:href="@{/admin/users(page=${currentPage - 1}, size=${pageSize}, status=${currentStatus}, role=${currentRole}, keyword=${currentKeyword})}"
							th:classappend="${currentPage == 1} ? 'pointer-events-none opacity-50' : ''"
							class="px-3 py-1 border rounded bg-white hover:bg-gray-100 transition">
							Trước </a>

						<th:block th:each="i : ${#numbers.sequence(1, totalPages)}">
							<a th:if="${i >= currentPage - 2 && i <= currentPage + 2}"
								th:href="@{/admin/users(page=${i}, size=${pageSize}, status=${currentStatus}, role=${currentRole}, keyword=${currentKeyword})}"
								th:text="${i}"
								th:classappend="${currentPage == i} ? 'bg-blue-600 text-white border-blue-600' : 'bg-white hover:bg-gray-100'"
								class="px-3 py-1 border rounded transition"> </a>
						</th:block>

						<a
							th:href="@{/admin/users(page=${currentPage + 1}, size=${pageSize}, status=${currentStatus}, role=${currentRole}, keyword=${currentKeyword})}"
							th:classappend="${currentPage == totalPages} ? 'pointer-events-none opacity-50' : ''"
							class="px-3 py-1 border rounded bg-white hover:bg-gray-100 transition">
							Sau </a>
					</div>
				</div>
			</div>
		</main>

		<div th:replace="~{fragments/footer :: footer}"></div>
	</div>

	<script th:src="@{/js/users.js}"></script>
</body>
</html>